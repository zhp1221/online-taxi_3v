# 1. 网约车项目设计流程

# 目录

[TOC]

# 一. 项目概述-需求分析

## 1. 项目流程

1. 启动

   > 可行性分析，立项。
   >
   > 项目背景：**面试：（背景，为什么做？残障人士（后备箱有轮椅），孕妇（开车比较稳司机），小孩（儿童座椅））。**

2. 计划阶段

   > 进度安排，资源计划，成本估计，质量保证计划，风险，实施。
   >
   > **面试：（1 加班，2加人，加资源，3 功能排优先级，重要的先做保证能用，后面再迭代。）**

3. 实施控制阶段

   > 开发，测试，等等。

4. 收尾

   > 验收。产品验收。

## 2. 项目人手方面流程安排

1. 项目和产品

   > 矩阵式（开发：1组，2组，产品1组，2组），项目组。

2. 人员安排

   > 项目管理：3（1高级项目经理，2助理）
   >
   > 技术总监：1
   >
   > 运维：2
   >
   > 能力层：10
   >
   > 业务层：12
   >
   > 产品：10，（乘客，司机，boss，h5）
   >
   > 安卓：4
   >
   > ios：3
   >
   > h5:5
   >
   > 测试：20（功能，自动化测试，接口测试，安全测试）
   >
   > 运营，市场，大客户关系：未知。

3. 你在项目中的职责

   > 组长：接口定义，工程结构设计，代码review，各方沟通（产品，测试），核心功能开发。
   >
   > 组员：具体开发实现。核心功能开发。

4. Kick Off

   > 各方参与，齐聚一堂。启动会。动员大会。

# 二. 实现的需求

## 1.乘客端

1. 发送验证码

   >  三挡验证。技术人员防止恶意发短信。

2. 登录/注册

3. 查看开通区域

   > 高德围栏

4. 预估价格

5. 下单

6. 司机流程

7. 支付（分布式事务：订单，支付，积分）

8. 评价

## 2. 司机端

1. 发送验证码
2. 登录/注册
3. 查看，改变司机状态
4. 司机抢单（分布式锁）
5. 订单状态变更
6. 发起收款

## 3. Boss

>  运营

# 三. 微服务设计原则

> 架构，模式，拆分，隔离。目标：**隔离系统的变化点**。

## 1. 具体原则：

> 高内聚，低耦合。
>
> 高度自治：开发，测试，构建，部署，运行，发布。（无状态）
>
> 以业务为中心。
>
> 弹性设计。（容错，隔离，降级）。
>
> 自动化。持续集成，持续交付。
>
> 粒度把控：没有标准。任何一个服务，不要因为自己的开发和维护，影响其他服务。
>
> 
>
> api组，service组。
>
> 业务层，能力层。

## 2. 分布式AKF拆分原则

AKF详细介绍：https://www.cnblogs.com/-wenli/p/13584796.html

> x轴：水平复制。A  A  A   A   A。
>
> y轴：A 
>
> z轴：数据分片：手机，衣服，家电。； 杭州，北京。盘古。

<img src="1. 网约车项目设计流程.assets/akf-1632885649900.jpg" alt="akf" style="zoom: 67%;" />

# 四. 服务拆分（隔离系统的变化点）

## 1. 业务层

| 模块     | 项目名                                           | 描述     |
| -------- | ------------------------------------------------ | -------- |
| 乘客端   | api-passenger(订单bean。@RequestBody 订单的bean) | 乘客端   |
| 司机端   | api-driver                                       | 司机端   |
| 司机听单 | api-listen-order                                 | 司机听单 |

## 2. 能力层

| 模块         | 项目名                                           |
| ------------ | ------------------------------------------------ |
| app升级      | service-app-update                               |
| 订单         | service-order(订单bean。@RequestBody 订单的bean) |
| 派单         | service-order-dispatch                           |
| 乘客用户管理 | service-passenger-user                           |
| 短信         | service-sms                                      |
| 计价         | service-valuation                                |
| 验证码       | service-verification-code                        |
| 钱包         | service-wallet                                   |
| 支付         | service-payment                                  |
| 地图         | service-map                                      |

## 3. Springcloud基础

| 模块         | 项目名                  |
| ------------ | ----------------------- |
| 注册中心     | cloud-eureka            |
| 配置中心     | cloud-config-server     |
| 网关         | cloud-zuul              |
| 熔断监控(ui) | cloud-hystrix-dashboard |
| 健康检查     | cloud-admin             |
| 链路追踪     | cloud-zipkin-ui         |

## 4. 抽取公共的common

| 模块                    | 项目名          |
| ----------------------- | --------------- |
| 通用，工具类,异常，校验 | internal-common |

## 5. 用到的技术

+ 技术	

  > boot,cloud,maven,git ,mysql,reids, mq

+ 第三方技术

  > 短信服务（腾讯，阿里短信，华信），
  >
  > 语音服务：隐私号。（乘客和司机订单匹配后，A，B，X），录音。
  >
  > 文件服务oss：
  >
  > 地图：高德。
  >
  > 消息推送：极光。透传，通知。
  >
  > 支付：微信，支付宝。
  >
  > 航旅纵横：查航班。
  >
  > 发票：百望云。
  >
  > 前端：vue。android，ios。

## 6. 面试方面

> ***包装很重要***
>
> 
>
> 包装：云云。商务都来公司，跟我们技术做个交流，我们也了解他们怎么。技术情况，和我们业务结合是否匹配，开发是否易用，稳定，。。XXX。
>
> ---
>
> 1500,2000。
>
> 能力层：qps：2000（配置 ）.   有些 300.
>
> 2000，了解到 qps，该如何做：xxxx。
>
> ---
>
> 接口定了，之后，app，后端，同时开发。

## 7. 接口设计与安全

1. **接口设计**	

   + 后端定接口。

     > http://xxxx:port/urixxx/?xx
     >
     > body{}
     >
     > 接口名字。user/   user/add user/xxx
     >
     > ---
     >
     > restful（资源变现层状态转移）:风格。多种实现，http。
     >
     > **重在：资源。**

   + 考虑的点

     > 协议：https。iOS只能用https（？）。
     >
     > 域名：/restapi.yuming.com/
     >
     > 版本：v1
     >
     > 路径：/xxoo/xxoo/ (名词)
     >
     > 动作：
     >
     > ​	post:新建
     >
     > ​	put:修改（修改后的全量数据）
     >
     > ​	patch:修改(修改哪个，传哪个)
     >
     > ​	delete:删除
     >
     > ​	get:查询。

2. **接口安全**

   + **CIA**：保密性，完整性，可用性。

     手机号，身份证号，脱敏。

   + **数据层面**：sql注入，（id，sql）

     select * form table where name = (变量1;delete table)

     过滤 jsoup框架。

   + **xxs**：<script>alert("xxx")</script>, spring-htmlUtils。

     在正常用户请求中执行了黑客提供的恶意代码，问题出在：**用户数据没有过滤，转义。**

   + **csrf**: 

     > + 人机交互。token。
     >
     > 冒充别人的登录信息，问题出在：**没有防范不信任的调用**。

     > owasp-java-html-sanitizer
     > https://www.cnblogs.com/qizhelongdeyang/p/9884716.html

   + **数据权限控制**

     > link1链接。
     >
     > A用户请求，删除 order/a1   
     >
     > B用户请求，删除 order/a1   

1000,压测1500.

Query Per second 并发数

Transaction Per second 吞吐量

jsoup里的xss whitelist(白名单)有6种方法，一个构造方法和5种静态方法。

# 五. 微服务项目架构

> 项目在独立仓库中。

## 1. 整体

```sh
|--online-taxi-three
	!-- 项目A
	|-- 项目B
```

## 2. 单独项目

```sh
|--pom
|--src
	|--controller
	|--service
		impl
		接口
	|--dao
    	entity
    	mapper
    |--manager
    |--constant常量
    |--request 接受的参数bean
    |--response返回参数bean
|--resource
	|--mapper
		|--xxxxMapper.xml
	yml	
```



## 3. 异常

> dao层的异常：不用打日志。catch。跑上去。
>
> service:打日志，详细信息。时间，参数，
>
> controller: 异常包装成 状态码。

service:打日志，详细信息。时间，参数，

controller: 异常包装成 状态码。


